<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Climate Risk Scan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">

<!-- jQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: radial-gradient(circle at top, #2b2f4b, #0f1220);
  color: #e5e7eb;
}

/* ================= NAV ================= */
nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 32px;
}
nav .logo { font-weight: 700; font-size: 20px; }
nav a {
  color: #c7d2fe;
  margin-left: 24px;
  text-decoration: none;
  font-weight: 600;
}
nav a:hover { color: #fff; }

/* ================= HERO ================= */
.hero {
  text-align: center;
  padding: 60px 16px 32px;
}
.hero h1 { font-size: 42px; margin-bottom: 10px; }
.hero p { font-size: 18px; color: #cbd5f5; }

/* ================= CARD ================= */
.card {
  max-width: 1200px;
  margin: 28px auto;
  background: #ffffff;
  color: #111827;
  border-radius: 16px;
  padding: 26px;
  box-shadow: 0 25px 50px rgba(0,0,0,0.25);
}

/* ================= MAP ================= */
#map {
  height: 420px;
  border-radius: 12px;
  margin-bottom: 20px;
}

/* ================= CONTROLS ================= */
.controls {
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
}
.controls input,
.controls button {
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
}
.controls input {
  border: 1px solid #d1d5db;
  width: 180px;
}
.controls button {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: white;
  border: none;
  font-weight: 700;
  cursor: pointer;
  min-height: 44px;
}
.controls button:disabled {
  opacity: 0.6;
}

/* ================= STATUS ================= */
#status {
  margin-top: 16px;
  padding: 12px;
  border-radius: 10px;
  font-weight: 600;
  display: none;
}
.loading { background:#fef3c7; color:#92400e; }
.error   { background:#fee2e2; color:#991b1b; }
.success { background:#dcfce7; color:#166534; }

/* ================= MODAL ================= */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(4px);
  z-index: 999;
  overflow-y: auto;
  padding-bottom: env(safe-area-inset-bottom);
}
.modal-content {
  background: white;
  color: #111827;
  width: 94%;
  max-width: 1200px;
  margin: 6vh auto;
  border-radius: 16px;
  padding: 24px;
}
.modal-close {
  float: right;
  font-size: 20px;
  background: none;
  border: none;
  cursor: pointer;
}

/* ================= TABLE (DESKTOP) ================= */
table.dataTable {
  font-family: "IBM Plex Mono", monospace;
  font-size: 13px;
}
.color-5 { background:#7f1d1d;color:#fff }
.color-4 { background:#b91c1c;color:#fff }
.color-3 { background:#f59e0b }
.color-2 { background:#93c5fd }
.color-1 { background:#dbeafe }
.color-0 { background:#f9fafb }

/* ================= MOBILE RESULT CARDS ================= */
.mobile-cards { display: none; }
.card-row {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 10px;
}
.card-row h4 {
  margin: 0 0 8px;
}

/* ================= FOOTER ================= */
footer {
  text-align: center;
  padding: 30px;
  color: #94a3b8;
  font-size: 14px;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
  nav { padding: 14px 16px; }
  nav a { margin-left: 16px; }

  .hero h1 { font-size: 30px; }
  .hero p { font-size: 16px; }

  #map { height: 300px; }

  .controls input,
  .controls button {
    width: 100%;
  }

  #status {
    position: sticky;
    top: 10px;
    z-index: 10;
  }

  table.dataTable { display: none; }
  .mobile-cards { display: block; }
}
</style>
</head>

<body>

<nav>
  <div class="logo">üåç Climate Risk</div>
  <div>
    <a href="#">Home</a>
    <a href="#">Product</a>
    <a href="#faq">FAQ</a>
  </div>
</nav>

<div class="hero">
  <h1>Free Climate Risk Scan</h1>
  <p>Instant climate hazard profile for any location on Earth</p>
</div>

<div class="card">
  <h3>‚ë† Select Location</h3>
  <div id="map"></div>

  <h3>‚ë° Run Climate Model</h3>
  <div class="controls">
    <input id="lat" placeholder="Latitude" readonly>
    <input id="lon" placeholder="Longitude" readonly>
    <input id="city" placeholder="City (optional)">
    <button id="runBtn" onclick="compute()">üöÄ Run Climate Model</button>
  </div>

  <div id="status"></div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h3 id="resultTitle"></h3>

    <table id="hazardTable" class="display" style="width:100%">
      <thead><tr><th>Hazard</th></tr></thead>
      <tbody></tbody>
    </table>

    <div class="mobile-cards" id="mobileCards"></div>
  </div>
</div>

<div class="card" id="faq">
  <h2>FAQ</h2>
  <p><b>How long does one scan take?</b><br>3‚Äì10 minutes depending on location.</p>
  <p><b>What models are used?</b><br>ERA5 observations + CMIP6 SSP scenarios.</p>
  <p><b>Is this free?</b><br>Yes ‚Äî limited single-location scans.</p>
</div>

<footer>
  ¬© Climate Risk Platform ‚Äî Scientific climate intelligence
</footer>

<script>
let map, marker;

function initMap() {
  map = L.map('map').setView([20,0], 2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  map.on('click', e => {
    lat.value = e.latlng.lat.toFixed(5);
    lon.value = e.latlng.lng.toFixed(5);
    marker ? marker.setLatLng(e.latlng) : marker = L.marker(e.latlng).addTo(map);
  });
}

function showStatus(msg, cls){
  const s = document.getElementById('status');
  s.textContent = msg;
  s.className = cls;
  s.style.display = 'block';
}

async function compute(){
  if (!lat.value || !lon.value) {
    showStatus("‚ùó Select a location first", "error"); return;
  }

  runBtn.disabled = true;
  runBtn.textContent = "‚è≥ Computing‚Ä¶";
  showStatus("üîÑ Running climate models (3‚Äì10 min)‚Ä¶", "loading");

  const res = await fetch(`/run?lat=${lat.value}&lon=${lon.value}`);
  const json = await res.json();

  renderResults(json.data, json.columns);
  showStatus("‚úÖ Scan complete", "success");
  modal.style.display = 'block';

  runBtn.disabled = false;
  runBtn.textContent = "üöÄ Run Climate Model";
}

function renderResults(data, columns){
  // Desktop table
  if ($.fn.DataTable.isDataTable('#hazardTable')) {
    $('#hazardTable').DataTable().destroy();
  }
  $('#hazardTable thead tr').html(
    '<th>Hazard</th>' + columns.slice(1).map(c=>`<th>${c}</th>`).join('')
  );
  $('#hazardTable tbody').html(
    data.map(r=>`
      <tr>
        <td>${r.Hazard}</td>
        ${columns.slice(1).map(c=>{
          const v=r[c];
          return `<td class="color-${Math.floor(v??0)}">${v==null?'‚Äî':v.toFixed(2)}</td>`;
        }).join('')}
      </tr>`).join('')
  );
  $('#hazardTable').DataTable({ paging:false, scrollX:true });

  // Mobile cards
  mobileCards.innerHTML = data.map(r=>`
    <div class="card-row">
      <h4>${r.Hazard}</h4>
      ${columns.slice(1).map(c=>{
        const v=r[c];
        return `<div><b>${c}:</b> ${v==null?'‚Äî':v.toFixed(2)}</div>`;
      }).join('')}
    </div>`).join('');
}

function closeModal(){ modal.style.display = 'none'; }

document.addEventListener('DOMContentLoaded', initMap);
</script>

</body>
</html>
