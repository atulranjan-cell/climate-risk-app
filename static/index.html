<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Climate Risk Scan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">

<!-- jQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
/* =====================================================
   1. GLOBAL BASE
===================================================== */
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: radial-gradient(circle at top, #2b2f4b, #0f1220);
  color: #e5e7eb;
}

/* =====================================================
   2. NAVBAR
===================================================== */
nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 40px;
}

nav .logo {
  font-weight: 700;
  font-size: 20px;
  letter-spacing: 0.5px;
}

nav a {
  color: #c7d2fe;
  margin-left: 28px;
  text-decoration: none;
  font-weight: 600;
}

nav a:hover { color: #ffffff; }

/* =====================================================
   3. HERO
===================================================== */
.hero {
  text-align: center;
  padding: 70px 20px 40px;
}

.hero h1 {
  font-size: 42px;
  margin-bottom: 10px;
}

.hero p {
  font-size: 18px;
  color: #cbd5f5;
}

/* =====================================================
   4. CARD CONTAINER
===================================================== */
.card {
  max-width: 1200px;
  margin: 30px auto;
  background: #ffffff;
  color: #111827;
  border-radius: 16px;
  padding: 28px;
  box-shadow: 0 25px 50px rgba(0,0,0,0.25);
}

/* =====================================================
   5. MAP
===================================================== */
#map {
  height: 420px;
  border-radius: 12px;
  margin-bottom: 20px;
}

/* =====================================================
   6. CONTROLS
===================================================== */
.controls {
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.controls input {
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 15px;
  width: 170px;
}

.controls button {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 12px 26px;
  font-weight: 700;
  cursor: pointer;
}

.controls button:hover {
  transform: translateY(-1px);
}

/* =====================================================
   7. STATUS
===================================================== */
#status {
  padding: 12px;
  border-radius: 8px;
  font-weight: 600;
  display: none;
}

.loading { background:#fef3c7; color:#92400e; }
.error   { background:#fee2e2; color:#991b1b; }
.success { background:#dcfce7; color:#166534; }

/* =====================================================
   8. MODAL
===================================================== */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  z-index: 999;
}

.modal-content {
  background: white;
  color: #111827;
  width: 92%;
  max-width: 1200px;
  margin: 6vh auto;
  border-radius: 16px;
  padding: 26px;
  animation: rise 0.25s ease-out;
}

@keyframes rise {
  from { transform: translateY(30px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}

/* =====================================================
   9. TABLE
===================================================== */
table.dataTable {
  font-family: "IBM Plex Mono", monospace;
  font-size: 13px;
}

.color-5 { background:#7f1d1d;color:#fff }
.color-4 { background:#b91c1c;color:#fff }
.color-3 { background:#f59e0b }
.color-2 { background:#93c5fd }
.color-1 { background:#dbeafe }
.color-0 { background:#f9fafb }

/* =====================================================
   10. FOOTER
===================================================== */
footer {
  text-align: center;
  padding: 30px;
  color: #94a3b8;
  font-size: 14px;
}
</style>
</head>

<body>

<!-- NAV -->
<nav>
  <div class="logo">üåç Climate Risk</div>
  <div>
    <a href="#">Home</a>
    <a href="#">Product</a>
    <a href="#faq">FAQ</a>
  </div>
</nav>

<!-- HERO -->
<div class="hero">
  <h1>Free Climate Risk Scan</h1>
  <p>Instant climate hazard profile for any location on Earth</p>
</div>

<!-- MAIN CARD -->
<div class="card">
  <h3>‚ë† Select Location</h3>
  <div id="map"></div>

  <h3>‚ë° Run Climate Model</h3>
  <div class="controls">
    <input id="lat" placeholder="Latitude" readonly>
    <input id="lon" placeholder="Longitude" readonly>
    <input id="city" placeholder="City (optional)">
    <button onclick="compute()">üöÄ Run Climate Model</button>
  </div>

  <div id="status"></div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="resultTitle"></h3>
    <table id="hazardTable" class="display" style="width:100%">
      <thead><tr><th>Hazard</th></tr></thead>
      <tbody></tbody>
    </table>
    <br>
    <button onclick="closeModal()">Close</button>
  </div>
</div>

<!-- FAQ -->
<div class="card" id="faq">
  <h2>FAQ</h2>
  <p><b>How long does one scan take?</b><br>3‚Äì10 minutes depending on location and model complexity.</p>
  <p><b>What models are used?</b><br>ERA5 observations and CMIP6 SSP scenarios.</p>
  <p><b>Is this free?</b><br>Yes ‚Äî limited to single-location scans.</p>
</div>

<footer>
  ¬© Climate Risk Platform ‚Äî Scientific climate intelligence
</footer>

<script>
let map, marker;

function initMap() {
  map = L.map('map').setView([20,0], 2);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  map.on('click', e => {
    document.getElementById('lat').value = e.latlng.lat.toFixed(5);
    document.getElementById('lon').value = e.latlng.lng.toFixed(5);
    marker ? marker.setLatLng(e.latlng) : marker = L.marker(e.latlng).addTo(map);
  });
}

function showStatus(msg, cls){
  const s = document.getElementById('status');
  s.textContent = msg;
  s.className = cls;
  s.style.display = 'block';
}

async function compute(){
  showStatus("‚è≥ Running climate models (this may take several minutes)‚Ä¶", "loading");

  const lat = lat.value, lon = lon.value;
  const res = await fetch(`/run?lat=${lat}&lon=${lon}`);
  const json = await res.json();

  renderTable(json.data, json.columns);
  showStatus("‚úÖ Scan complete", "success");
  document.getElementById('modal').style.display = 'block';
}

function renderTable(data, columns){
  $('#hazardTable').DataTable().destroy();

  $('#hazardTable thead tr').html(
    '<th>Hazard</th>' + columns.slice(1).map(c=>`<th>${c}</th>`).join('')
  );

  $('#hazardTable tbody').html(
    data.map(r=>{
      return `<tr><td>${r.Hazard}</td>` +
        columns.slice(1).map(c=>{
          const v = r[c];
          return `<td class="color-${Math.floor(v||0)}">${v?.toFixed(2)||'‚Äî'}</td>`;
        }).join('') +
      `</tr>`;
    }).join('')
  );

  $('#hazardTable').DataTable({ paging:false, scrollX:true });
}

function closeModal(){
  document.getElementById('modal').style.display = 'none';
}

document.addEventListener('DOMContentLoaded', initMap);
</script>

</body>
</html>
